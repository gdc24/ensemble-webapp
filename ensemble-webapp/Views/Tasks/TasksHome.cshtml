@using ensemble_webapp.Database

@model ensemble_webapp.ViewModels.TasksHomeVM
@{
    ViewBag.Title = "TasksHome";
}


    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2>Tasks</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <p>Name: @Model.CurrentUser.StrName</p>
            </div>
        </div>
        @if (Model.TasksUnfinishedNotYetDueForUser.Any())
        {
            using (Html.BeginForm("AddTask", "Tasks", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                <div class="row">
                    <div class="col-12">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Note</th>
                                    <th>Due Date</th>
                                    <th>Event</th>
                                    <th>Assigned by</th>
                                    <th>Mark As Done</th>
                                </tr>
                            </thead>
                            @foreach (var t in Model.TasksUnfinishedNotYetDueForUser)
                            {
                                <tr>
                                    <td>@t.StrName</td>
                                    <td>@t.StrAttachment</td>
                                    <td>@t.DtmDue</td>
                                    <td>@t.Event.StrName</td>
                                    <td>@t.UserAssignedBy.StrName</td>
                                    <td><input type="button" value="Done!" class="btn btn-success" onclick="location.href='@Url.Action("MarkTaskFinished", "Tasks")?intTaskID=' + @t.IntTaskID" /></td>
                                </tr>
                            }
                        </table>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="row">
                <div class="col-12">
                    <p>you have no tasks due</p>
                </div>
            </div>
        }
        @if (Model.TasksOverDueForUser.Any())
        {
            <div class="row">
                <div class="col-12">
                    <p>overdue tasks</p>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Note</th>
                                <th>Due Date</th>
                                <th>Event</th>
                                <th>Assigned by</th>
                                <th>Mark As Done</th>
                            </tr>
                        </thead>
                        @foreach (var t in Model.TasksOverDueForUser)
                        {
                            <tr>
                                <td>@t.StrName</td>
                                <td>@t.StrAttachment</td>
                                <td>@t.DtmDue</td>
                                <td>@t.Event.StrName</td>
                                <td>@t.UserAssignedBy.StrName</td>
                                <td><input type="button" value="Done!" class="btn btn-success" onclick="location.href='@Url.Action("MarkTaskFinished", "Tasks")?intTaskID=' + @t.IntTaskID" /></td>
                            </tr>
                        }
                    </table>
                </div>
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-12">
                    <p>you have no over due tasks!</p>
                </div>
            </div>
        }
        @if (Model.FinishedTasks.Any())
        {
            <div class="row">
                <div class="col-12">
                    <p>Completed Tasks</p>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Note</th>
                                <th>Due Date</th>
                                <th>Event</th>
                                <th>Assigned by</th>
                            </tr>
                        </thead>
                        @foreach (var t in Model.FinishedTasks)
                        {
                            <tr>
                                <td>@t.StrName</td>
                                <td>@t.StrAttachment</td>
                                <td>@t.DtmDue</td>
                                <td>@t.Event.StrName</td>
                                <td>@t.UserAssignedBy.StrName</td>
                            </tr>
                        }
                    </table>
                    </div>
                </div>
         } else
         {
            <div class="row">
                <div class="col-12">
                    <p>no tasks completed yet</p>
                </div>
            </div>
         }
        @if (Globals.IS_ADMIN)
        {
            if (Model.TasksAssignedByUser.Any())
            {

                <div class="row">
                    <div class="col-12">
                        <p>Tasks Assigned By You</p>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Note</th>
                                    <th>Due Date</th>
                                    <th>Event</th>
                                    <th>Assigned To</th>
                                    <th>Is Done</th>
                                </tr>
                            </thead>
                            @foreach (var t in Model.TasksAssignedByUser)
                            {
                                <tr>
                                    <td>@t.StrName</td>
                                    <td>@t.StrAttachment</td>
                                    <td>@t.DtmDue</td>
                                    <td>@t.Event.StrName</td>
                                    <td>@t.UserAssignedTo.StrName</td>
                                    <td>@t.YsnIsFinished</td>
                                </tr>
                            }
                        </table>
                    </div>
                </div>
            }

                <div class="row">
                    <div class="col-12">
                        <h1 class="display-2">
                            Add A Task
                        </h1>
                    </div>
                </div>

                using (Html.BeginForm("AddTask", "Tasks", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    <div class="row row-new-task">
                        <div class="col-3">
                            <label for="NewTask.DtmDue">due date</label>
                            @Html.EditorFor(m => m.NewTask.DtmDue, new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                        <div class="col-4">
                            <label for="NewTask.StrName">name</label>
                            @Html.EditorFor(m => m.NewTask.StrName, new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                        <div class="col-3">
                            <label for="NewTask.StrAttachment">description</label>
                            @Html.TextAreaFor(m => m.NewTask.StrAttachment, new { @class = "form-control" })
                        </div>
                        <div class="col-4">
                            <label for="NewTask.UserAssignedTo.IntUserID">assign to user</label>
                            @Html.DropDownListFor(m => m.NewTask.UserAssignedTo.IntUserID, new SelectList(Model.LstAllUsers, "intUserID", "strName"), new { @class = "form-control" })
                        </div>
                        <div class="col-4">
                            <label for="NewTask.Event.IntEventID">event</label>
                            @Html.DropDownListFor(m => m.NewTask.Event.IntEventID, new SelectList(Model.LstAllEvents, "intEventID", "strName"), new { @class = "form-control" })
                        </div>
                        <div class="col-2">
                            <br />
                            <input type="submit" value="create task" class="form-control btn-primary" />
                        </div>

                    </div>
                }

            }


        </div>